<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Review Questions - SelectBook</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f6f8fc;
    }

    .header {
      background: #003366;
      color: #fff;
      padding: 14px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }

    /* filter buttons */
    .filter-bar {
      display: flex;
      gap: 8px;
      padding: 8px;
      overflow-x: auto;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }

    .filter-btn {
      padding: 6px 14px;
      font-size: 14px;
      border-radius: 20px;
      background: #eee;
      border: none;
      cursor: pointer;
    }

    .filter-btn.active {
      background: #003366;
      color: #fff;
    }

    /* question strip */
    .review-strip-container {
      overflow-x: auto;
      white-space: nowrap;
      padding: 10px;
      background: #ffffff;
      border-bottom: 1px solid #ddd;
    }

    .review-circle {
      width: 36px;
      height: 36px;
      min-width: 36px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      margin-right: 10px;
      font-size: 14px;
      color: #fff;
      cursor: pointer;
      user-select: none;
    }

    /* transparent soft green/red */
    .correct {
      background: rgba(46, 204, 113, 0.15);
      border: 2px solid rgba(46, 204, 113, 0.45);
      color: #008f41;
    }

    .incorrect {
      background: rgba(231, 76, 60, 0.15);
      border: 2px solid rgba(231, 76, 60, 0.45);
      color: #bf2f2f;
    }

    .unattempted {
      background: #95a5a6;
    }

    /* content */
    .review-container {
      padding: 12px;
    }

    .question-box {
      background: #fff;
      padding: 14px;
      border-radius: 8px;
      min-height: 250px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    }

    .question-text {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .option {
      padding: 6px 8px;
      border-radius: 4px;
      margin-bottom: 6px;
      font-size: 15px;
    }

    /* softer green/red option style */
    .option.correct {
      background: rgba(46, 204, 113, 0.15);
      border: 1px solid rgba(46, 204, 113, 0.45);
      color: #008f41;
      font-weight: 500;
    }

    .option.incorrect {
      background: rgba(231, 76, 60, 0.15);
      border: 1px solid rgba(231, 76, 60, 0.45);
      color: #bf2f2f;
      font-weight: 500;
    }

    /* explanation box (hidden by default, shown via JS) */
    .explanation-box {
      margin-top: 14px;
      background: #f1f8ff;
      padding: 10px;
      border-left: 4px solid #003366;
      border-radius: 5px;
      display: none;
      max-height: 200px;   /* scrolling height limit */
      overflow-y: auto;    /* scroll when big text */
    }

    .explanation-title {
      font-weight: bold;
      font-size: 15px;
      margin-bottom: 6px;
      color: #003366;
    }

    /* Explanation button */
    .exp-btn {
      margin-top: 10px;
      padding: 6px 12px;
      border-radius: 4px;
      border: 1px solid #003366;
      background: #ffffff;
      color: #003366;
      font-size: 14px;
      cursor: pointer;
    }

    /* Desktop view fit */
    @media (min-width:800px){
      .review-container{
        max-width: 900px;
        margin: 16px auto;
      }
      .question-box{
        max-width: 900px;
        margin: 0 auto;
      }
      .review-strip-container{
        text-align:center;
      }
    }
  </style>
</head>
<body>

  <div class="header">Review Questions</div>

  <!-- Filter -->
  <div class="filter-bar">
    <button class="filter-btn active" onclick="setFilter('all')">All</button>
    <button class="filter-btn" onclick="setFilter('correct')">Correct</button>
    <button class="filter-btn" onclick="setFilter('wrong')">Wrong</button>
    <button class="filter-btn" onclick="setFilter('unattempted')">Unattempted</button>
  </div>

  <!-- Strip -->
  <div class="review-strip-container" id="review-strip"></div>

  <div class="review-container">
    <div id="question-view" class="question-box"></div>
  </div>

  <script>
    let questions = [];
    let answers = [];
    let index = 0;
    let filter = "all";
    let filteredIndexes = [];

    function loadData(){
      questions = JSON.parse(localStorage.getItem("selectbook-questions") || "[]");
      answers   = JSON.parse(localStorage.getItem("selectbook-userAnswers") || "[]");

      buildFilteredList();
      buildStrip();
      if (filteredIndexes.length > 0) {
        showQ(filteredIndexes[0]);
      } else {
        document.getElementById("question-view").innerHTML = "<p>No questions to review.</p>";
      }
    }

    function setFilter(type){
      filter = type;
      document.querySelectorAll('.filter-btn').forEach(btn=>{
        btn.classList.remove("active");
      });
      event.target.classList.add("active");

      buildFilteredList();
      buildStrip();
      if (filteredIndexes.length > 0) {
        showQ(filteredIndexes[0]);
      } else {
        document.getElementById("question-view").innerHTML = "<p>No questions in this filter.</p>";
      }
    }

    function buildFilteredList(){
      filteredIndexes = [];
      questions.forEach((q,i)=>{
        let status = "unattempted";
        if(answers[i] != null){
          status = (answers[i]===q.answer) ? "correct":"wrong";
        }
        if(filter==="all") filteredIndexes.push(i);
        if(filter==="correct" && status==="correct") filteredIndexes.push(i);
        if(filter==="wrong" && status==="wrong") filteredIndexes.push(i);
        if(filter==="unattempted" && status==="unattempted") filteredIndexes.push(i);
      });
    }

    function buildStrip(){
      const strip = document.getElementById("review-strip");
      strip.innerHTML = "";

      filteredIndexes.forEach((i)=>{
        let status="unattempted";
        if(answers[i] != null){
          status = (answers[i]===questions[i].answer) ? "correct":"incorrect";
        }
        const btn = document.createElement("div");
        btn.className="review-circle "+status;
        btn.textContent = i+1;
        btn.onclick = ()=>showQ(i);
        strip.appendChild(btn);
      });
    }

    function showQ(i){
      index=i;
      let q = questions[i];
      let a = answers[i];

      let html = `<div class='question-text'>Q${i+1}. ${q.text}</div>`;

      q.options.forEach((opt,j)=>{
        let cls="option";
        if(q.answer===j){
          cls += " correct";
        }
        if(a===j && q.answer!==j){
          cls += " incorrect";
        }
        html += `<div class="${cls}">${String.fromCharCode(65+j)}) ${opt}</div>`;
      });

      if(q.explanation){
        html += `
          <button class="exp-btn" type="button" onclick="toggleExplanation()">
            Show Explanation
          </button>
          <div class="explanation-box" id="exp-box">
            <div class="explanation-title">Explanation:</div>
            <div>${q.explanation}</div>
          </div>
        `;
      }

      document.getElementById("question-view").innerHTML=html;
    }

    function toggleExplanation(){
      const box = document.getElementById("exp-box");
      const btn = document.querySelector(".exp-btn");
      if(!box || !btn) return;

      if(box.style.display === "none" || box.style.display === ""){
        box.style.display = "block";
        btn.textContent = "Hide Explanation";
      } else {
        box.style.display = "none";
        btn.textContent = "Show Explanation";
      }
    }

    /* Swipe */
    let sx;
    document.getElementById("question-view").addEventListener("touchstart",(e)=>{
      sx = e.touches[0].clientX;
    });

    document.getElementById("question-view").addEventListener("touchend",(e)=>{
      let ex = e.changedTouches[0].clientX;
      let diff = sx-ex;

      let pos = filteredIndexes.indexOf(index);

      if(diff>40 && pos<filteredIndexes.length-1){
        showQ(filteredIndexes[pos+1]);
      } else if(diff<-40 && pos>0){
        showQ(filteredIndexes[pos-1]);
      }
    });

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</body>
</html>